# Archivo de variables de entorno para AppGestion
# Generado automáticamente por Ansible - No editar manualmente

# Información del entorno
ENVIRONMENT={{ app_environment | default(environment) }}
PROJECT_NAME={{ project_name }}
AWS_REGION={{ aws_region | default(region) }}

# Información de API Gateway
API_GATEWAY_URL={{ api_endpoint | default(api_gateway_url) | default('') }}

# Configuración Frontend
FRONTEND_URL={{ cloudfront_url | default('') }}

# Configuración CORS mejorada - asegurar coherencia entre servicios
CORS_ALLOWED_ORIGINS={{ 'https://' + cloudfront_url if (cloudfront_url is defined and cloudfront_url and app_environment == 'production') else '*' }}
CORS_ORIGIN={{ 'https://' + cloudfront_url if (cloudfront_url is defined and cloudfront_url and app_environment == 'production') else '*' }}

# Configuración de reintentos y resiliencia
DB_MAX_RETRIES=30
DB_RETRY_INTERVAL=5
SERVICE_TIMEOUT=60

# Valores para reintentos según entorno
{% if app_environment | default(environment) == 'production' %}
HEALTH_CHECK_INTERVAL=30
RETRY_BACKOFF_FACTOR=2
STRICT_HEALTH_CHECK=true
{% else %}
HEALTH_CHECK_INTERVAL=15
RETRY_BACKOFF_FACTOR=1
STRICT_HEALTH_CHECK=false
{% endif %}

# Credenciales de base de datos (obtenidas de AWS Secrets Manager)
# Variables para el servicio de usuarios (compatibilidad con nombres esperados)
USER_DB_HOST={{ db_creds.host_user | default(db_creds.host) }}
USER_DB_PORT={{ db_creds.port | default('5432') }}
USER_DB_NAME={{ db_creds.db_name_user | default(db_creds.db_name) }}
USER_DB_USER={{ db_creds.username | default('dbadmin') }}
USER_DB_PASSWORD={{ db_creds.password | default('') }}
# Variables duplicadas para compatibilidad con Docker Compose
POSTGRES_HOST={{ db_creds.host_user | default(db_creds.host) }}
POSTGRES_PORT={{ db_creds.port | default('5432') }}
POSTGRES_DB={{ db_creds.db_name_user | default(db_creds.db_name) }}
POSTGRES_USER={{ db_creds.username | default('dbadmin') }}
POSTGRES_PASSWORD={{ db_creds.password | default('') }}

# Servicio de productos (compatibilidad con nombres esperados)
PRODUCT_DB_HOST={{ db_creds.host_product | default(db_creds.host) }}
PRODUCT_DB_PORT={{ db_creds.port | default('5432') }}
PRODUCT_DB_NAME={{ db_creds.db_name_product | default(db_creds.db_name) }}
PRODUCT_DB_USER={{ db_creds.username | default('dbadmin') }}
PRODUCT_DB_PASSWORD={{ db_creds.password | default('') }}
# Variables duplicadas para el servicio de productos
PRODUCT_POSTGRES_HOST={{ db_creds.host_product | default(db_creds.host) }}
PRODUCT_POSTGRES_PORT={{ db_creds.port | default('5432') }}
PRODUCT_POSTGRES_DB={{ db_creds.db_name_product | default(db_creds.db_name) }}
PRODUCT_POSTGRES_USER={{ db_creds.username | default('dbadmin') }}
PRODUCT_POSTGRES_PASSWORD={{ db_creds.password | default('') }}

# Información adicional
DEPLOYMENT_DATE={{ ansible_date_time.iso8601 }}
DEPLOYMENT_VERSION={{ project_version | default('1.0.0') }}

# Configuración de aplicación
LOG_LEVEL={{ 'DEBUG' if (app_environment | default(environment)) == 'development' else 'INFO' }}
ENABLE_PROFILING={{ 'true' if (app_environment | default(environment)) == 'development' else 'false' }}

# Variables para Docker Compose y redes
COMPOSE_PROJECT_NAME={{ project_name }}
DOCKERHUB_USERNAME={{ docker_creds.username | default('') }}

# Variables para primer despliegue
FIRST_DEPLOYMENT={{ first_deployment | default('false') }}